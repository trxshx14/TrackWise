{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
:root {
  --primary-blue: #4a6fa5;
  --primary-dark: #2c5282;
  --primary-darker: #1a365d;
  --accent-light: #a7c5eb;
  --bg-light: #dbe4f0;
  --bg-page: #f0f4f8;
  --text-white: #ffffff;
  --success: #38a169;
  --warning: #ed8936;
  --danger: #e53e3e;
  --info: #4a6fa5;
  --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.15);
  --shadow-lg: 0 15px 35px rgba(0, 0, 0, 0.2);
  --transition: all 0.3s ease;
}

.report-issue-wrapper {
  padding: 2rem;
  min-height: 100vh;
  background-color: var(--bg-page);
  max-width: 900px;
  margin: 0 auto;
}

/* Header Section */
.report-header {
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-dark) 100%);
  border-radius: 20px;
  padding: 2.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
  text-align: center;
}

.report-header::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 200px;
  height: 200px;
  background: radial-gradient(circle, rgba(167, 197, 235, 0.2) 0%, transparent 70%);
  border-radius: 50%;
  transform: translate(30%, -30%);
}

.report-header h1 {
  color: var(--text-white);
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  position: relative;
  z-index: 1;
}

.report-header p {
  color: var(--accent-light);
  font-size: 1.1rem;
  margin: 0;
  opacity: 0.9;
  position: relative;
  z-index: 1;
}

/* Form Card */
.form-card {
  background: var(--text-white);
  border-radius: 20px;
  padding: 3rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.form-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 150px;
  height: 150px;
  background: radial-gradient(circle, rgba(167, 197, 235, 0.1) 0%, transparent 70%);
  border-radius: 50%;
  transform: translate(30%, -30%);
}

/* Form Elements */
.form-group {
  margin-bottom: 2rem;
  position: relative;
  z-index: 1;
}

.form-label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  color: var(--primary-dark);
  font-size: 1rem;
}

.required-star {
  color: var(--danger);
  margin-left: 0.25rem;
}

/* Form Controls */
.form-control,
.form-select,
.form-textarea {
  width: 100%;
  padding: 1.25rem;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-size: 1rem;
  transition: var(--transition);
  background: var(--bg-light);
  color: #333;
}

.form-control:focus,
.form-select:focus,
.form-textarea:focus {
  outline: none;
  border-color: var(--primary-blue);
  box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
  background: var(--text-white);
}

.form-textarea {
  min-height: 150px;
  resize: vertical;
}

.form-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234a6fa5' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 16px;
  padding-right: 3rem;
}

/* File Upload Styling */
.file-upload-wrapper {
  position: relative;
}

.file-input {
  opacity: 0;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
  z-index: 2;
}

.file-upload-label {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.25rem;
  border: 2px dashed #e2e8f0;
  border-radius: 12px;
  background: var(--bg-light);
  cursor: pointer;
  transition: var(--transition);
}

.file-upload-label:hover {
  border-color: var(--primary-blue);
  background: rgba(167, 197, 235, 0.1);
}

.file-upload-icon {
  font-size: 1.5rem;
  color: var(--primary-blue);
}

.file-upload-text {
  flex: 1;
}

.file-name {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: var(--primary-dark);
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* Form Help Text */
.form-help {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: #718096;
}

.form-help i {
  color: var(--primary-blue);
}

/* Error Messages */
.form-error {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: var(--danger);
}

.form-error i {
  font-size: 0.75rem;
}

/* Buttons */
.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 3rem;
  position: relative;
  z-index: 1;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1.25rem 2.5rem;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none;
  font-size: 1.1rem;
  box-shadow: var(--shadow-sm);
  flex: 1;
  justify-content: center;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
  color: var(--text-white);
}

.btn-primary:hover {
  background: linear-gradient(135deg, var(--primary-dark), var(--primary-darker));
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: var(--bg-light);
  color: var(--primary-dark);
  border: 2px solid #e2e8f0;
}

.btn-secondary:hover {
  background: var(--text-white);
  border-color: var(--primary-blue);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

/* Priority Indicator */
.priority-indicator {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.priority-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  opacity: 0.3;
  transition: var(--transition);
}

.priority-dot.active {
  opacity: 1;
}

.priority-dot.low { background: #38a169; }
.priority-dot.medium { background: #ed8936; }
.priority-dot.high { background: #e53e3e; }
.priority-dot.urgent { background: #9b2c2c; }

/* Responsive Design */
@media (max-width: 768px) {
  .report-issue-wrapper {
    padding: 1rem;
  }
  
  .report-header {
    padding: 2rem;
  }
  
  .report-header h1 {
    font-size: 2rem;
  }
  
  .form-card {
    padding: 2rem;
  }
  
  .form-actions {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .report-header {
    padding: 1.5rem;
  }
  
  .report-header h1 {
    font-size: 1.75rem;
  }
  
  .form-card {
    padding: 1.5rem;
  }
  
  .form-control,
  .form-select,
  .form-textarea {
    padding: 1rem;
  }
}
</style>
{% endblock %}

{% block title %}Report Issue - TrackWise{% endblock %}

{% block content %}
<div class="report-issue-wrapper">
    <!-- Header Section -->
    <section class="report-header">
        <h1>
            <i class="fas fa-flag"></i>
            Report New Issue
        </h1>
        <p>Describe the issue you're facing and our team will address it promptly</p>
    </section>

    <!-- Form Card -->
    <div class="form-card">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            {% for field in form %}
            <div class="form-group">
                <label class="form-label" for="{{ field.id_for_label }}">
                    <i class="fas 
                        {% if field.name == 'title' %}fa-heading
                        {% elif field.name == 'issue_type' %}fa-tag
                        {% elif field.name == 'priority' %}fa-exclamation-circle
                        {% elif field.name == 'description' %}fa-file-alt
                        {% elif field.name == 'attachment' or field.name == 'image' %}fa-paperclip
                        {% else %}fa-pen{% endif %}">
                    </i>
                    {{ field.label }}
                    {% if field.field.required %}<span class="required-star">*</span>{% endif %}
                </label>
                
                {% if field.name == 'description' %}
                <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" 
                          class="form-textarea" placeholder="{{ field.field.widget.attrs.placeholder|default:field.label }}"
                          {% if field.field.required %}required{% endif %}>{{ field.value|default:'' }}</textarea>
                
                {% elif field.name == 'issue_type' or field.name == 'priority' %}
                <!-- SPECIFICALLY HANDLE SELECT FIELDS -->
                <select name="{{ field.name }}" id="{{ field.id_for_label }}" 
                        class="form-select" 
                        {% if field.field.required %}required{% endif %}>
                    {% for value, label in field.field.choices %}
                    <option value="{{ value }}" {% if field.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>
                        {{ label }}
                    </option>
                    {% endfor %}
                </select>
                
                {% if field.name == 'priority' %}
                <div class="priority-indicator">
                    <div class="priority-dot low {% if field.value == 'low' %}active{% endif %}"></div>
                    <div class="priority-dot medium {% if field.value == 'medium' %}active{% endif %}"></div>
                    <div class="priority-dot high {% if field.value == 'high' %}active{% endif %}"></div>
                    <div class="priority-dot urgent {% if field.value == 'urgent' %}active{% endif %}"></div>
                </div>
                {% endif %}
                
                {% elif field.name == 'attachment' or field.name == 'image' %}
                <div class="file-upload-wrapper">
                    <input type="file" name="{{ field.name }}" id="{{ field.id_for_label }}" 
                           class="file-input" accept="{% if field.name == 'image' %}image/*{% else %}*/*{% endif %}"
                           {% if field.field.required %}required{% endif %}>
                    <label for="{{ field.id_for_label }}" class="file-upload-label">
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="file-upload-text">
                            <span>Click to upload {% if field.name == 'image' %}an image{% else %}a file{% endif %}</span>
                            <small>{% if field.name == 'image' %}PNG, JPG, GIF up to 5MB{% else %}Max file size: 10MB{% endif %}</small>
                            <div class="file-name" style="display: none;">
                                <i class="fas fa-file"></i>
                                <span></span>
                            </div>
                        </div>
                    </label>
                </div>
                
                {% else %}
                <!-- For text input fields like title -->
                <input type="text" 
                       name="{{ field.name }}" id="{{ field.id_for_label }}" 
                       class="form-control" value="{{ field.value|default:'' }}" 
                       placeholder="{{ field.field.widget.attrs.placeholder|default:field.label }}"
                       {% if field.field.required %}required{% endif %}>
                {% endif %}
                
                {% if field.help_text %}
                <div class="form-help">
                    <i class="fas fa-info-circle"></i>
                    {{ field.help_text }}
                </div>
                {% endif %}
                
                {% if field.errors %}
                <div class="form-error">
                    <i class="fas fa-exclamation-circle"></i>
                    {% for error in field.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            
            <!-- FORM ACTIONS SECTION - This was missing! -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Submit Issue
                </button>
                <a href="{% url 'staff_issues:issue_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // File upload preview
    const fileInputs = document.querySelectorAll('.file-input');
    fileInputs.forEach(input => {
        input.addEventListener('change', function() {
            const fileNameDisplay = this.parentElement.querySelector('.file-name');
            const fileNameSpan = fileNameDisplay.querySelector('span');
            
            if (this.files.length > 0) {
                fileNameSpan.textContent = this.files[0].name;
                fileNameDisplay.style.display = 'flex';
            } else {
                fileNameDisplay.style.display = 'none';
            }
        });
    });

    // Priority indicator
    const prioritySelect = document.querySelector('select[name="priority"]');
    if (prioritySelect) {
        prioritySelect.addEventListener('change', function() {
            const priorityDots = document.querySelectorAll('.priority-dot');
            priorityDots.forEach(dot => dot.classList.remove('active'));
            
            const selectedPriority = this.value;
            const activeDot = document.querySelector(`.priority-dot.${selectedPriority}`);
            if (activeDot) {
                activeDot.classList.add('active');
            }
        });
    }

    // Form validation styling
    const formControls = document.querySelectorAll('.form-control, .form-select, .form-textarea');
    formControls.forEach(control => {
        control.addEventListener('invalid', function() {
            this.style.borderColor = 'var(--danger)';
            this.style.boxShadow = '0 0 0 3px rgba(229, 62, 62, 0.1)';
        });
        
        control.addEventListener('input', function() {
            if (this.checkValidity()) {
                this.style.borderColor = 'var(--primary-blue)';
                this.style.boxShadow = '0 0 0 3px rgba(74, 111, 165, 0.1)';
            }
        });
    });

    // Button hover effects
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %}